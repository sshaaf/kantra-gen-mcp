---
- ruleID: "ejb-stateful-requires-architectural-change"
  message: |
    Stateful Session Beans require an **architectural redesign** for Quarkus. Quarkus does not directly support Stateful Session Beans.

    **Why the Change?**
    Stateful beans maintain conversational state in the application server, which conflicts with cloud-native, horizontally scalable architectures.

    **Before (Jakarta EE EJB):**
    ```java
    import jakarta.ejb.Stateful;

    @Stateful
    public class ShoppingCartBean {
        private List<Item> cartItems = new ArrayList<>();

        public void addItem(Item item) {
            cartItems.add(item);
        }
    }
    ```

    **After (Quarkus - External State):**
    ```java
    import jakarta.enterprise.context.ApplicationScoped;
    import jakarta.inject.Inject;

    @ApplicationScoped
    public class ShoppingCartService {
        @Inject
        RedisClient redisClient; // Or database/cache

        public void addItem(String sessionId, Item item) {
            // Store state externally
            redisClient.hset(sessionId, item.getId(), item);
        }
    }
    ```

    **Migration Options:**
    - Use Redis/Infinispan for session state
    - Use database-backed state management
    - Move state to client-side (JWT tokens)
    - Use Quarkus WebSockets with session management
  description: "Detects Java annotation: jakarta.ejb.Stateful"
  category: "mandatory"
  effort: 5
  labels:
    - "konveyor.io/source=jakarta-ee"
    - "konveyor.io/target=quarkus"
  links:
    - title: "EJB to Quarkus Migration Guide"
      url: "https://www.the-main-thread.com/p/from-heavyweight-to-hyperspeed-your"
    - title: "Quarkus Redis Guide"
      url: "https://quarkus.io/guides/redis"
  tag: []
  customVariable: []
  when:
    java.referenced:
      pattern: "jakarta.ejb.Stateful"
      location: "ANNOTATION"
