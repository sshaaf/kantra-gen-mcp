---
- ruleID: "add-global-exception-handler"
  message: |
    Struts `ExceptionHandler` should be replaced with Spring's `@ControllerAdvice`.

    **Before (Struts Exception Handler in struts-config.xml):**
    ```xml
    <global-exceptions>
        <exception
            key="error.database"
            type="java.sql.SQLException"
            handler="com.example.handler.DatabaseExceptionHandler"
            path="/WEB-INF/jsp/error.jsp"/>
    </global-exceptions>
    ```

    **After (Spring @ControllerAdvice):**
    ```java
    import org.springframework.web.bind.annotation.ControllerAdvice;
    import org.springframework.web.bind.annotation.ExceptionHandler;
    import org.springframework.ui.Model;

    @ControllerAdvice
    public class GlobalExceptionHandler {

        @ExceptionHandler(SQLException.class)
        public String handleDatabaseException(SQLException ex, Model model) {
            model.addAttribute("errorMessage", "Database error: " + ex.getMessage());
            return "error";
        }

        @ExceptionHandler(EntityNotFoundException.class)
        public String handleNotFound(EntityNotFoundException ex, Model model) {
            model.addAttribute("errorMessage", "Resource not found");
            return "error/404";
        }

        @ExceptionHandler(Exception.class)
        public String handleGenericException(Exception ex, Model model) {
            model.addAttribute("errorMessage", "An unexpected error occurred");
            return "error";
        }
    }
    ```

    **Benefits:**
    - Centralized exception handling
    - Type-safe exception routing
    - Automatic model population
    - Support for REST (`@RestControllerAdvice`)
  description: "Detects Java import: org.apache.struts.action.ExceptionHandler"
  category: "optional"
  effort: 2
  labels:
    - "konveyor.io/source=struts"
    - "konveyor.io/target=springboot"
  links:
    - title: "Struts to Spring Boot Migration Spec"
      url: "https://github.com/migtools/getting-started/blob/main/struts-1.0/spec.md"
    - title: "Spring Exception Handling"
      url: "https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-exceptionhandler.html"
  tag: []
  customVariable: []
  when:
    java.referenced:
      pattern: "org.apache.struts.action.ExceptionHandler"
      location: "IMPORT"
