---
- ruleID: "repository-direct-call-to-rest-client"
  message: |
    When decomposing a monolith into microservices, replace direct repository injections with MicroProfile Rest Client for cross-service communication.

    **Before (Monolith - Direct Repository):**
    ```java
    import org.ecjug.hackday.repository.MemberRepository;

    public class GroupServiceImpl {
        @Inject
        private MemberRepository memberRepository;

        public void addMemberToGroup(String groupId, Member member) {
            final Member memberFromDB = memberRepository.add(member);
            // ... rest of logic
        }
    }
    ```

    **After (Microservices - Rest Client):**
    ```java
    import org.eclipse.microprofile.rest.client.inject.RestClient;

    public class GroupServiceImpl {
        @Inject
        @RestClient
        private MemberApi memberApi;

        public void addMemberToGroup(String groupId, Member member) {
            final Member memberFromDB = memberApi.add(member);
            // ... rest of logic
        }
    }
    ```

    **Key Changes:**
    - Replace `@Inject Repository` with `@Inject @RestClient Api`
    - Create API interface with JAX-RS annotations
    - Configure base URL in `application.properties`
    - Each microservice owns its own data
  description: "Detects Java field: Repository"
  category: "mandatory"
  effort: 4
  labels:
    - "konveyor.io/source=monolith"
    - "konveyor.io/target=microprofile"
  links:
    - title: "Monolith to Microservices Guide"
      url: "https://github.com/lasalazarr/guide-monolithic-to-microservices"
    - title: "MicroProfile Rest Client"
      url: "https://microprofile.io/specifications/microprofile-rest-client/"
  tag: []
  customVariable: []
  when:
    java.referenced:
      pattern: "Repository"
      location: "FIELD"
