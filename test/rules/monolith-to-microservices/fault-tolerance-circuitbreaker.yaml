---
- ruleID: "add-microprofile-fault-tolerance-circuitbreaker"
  message: |
    Consider adding MicroProfile Fault Tolerance `@CircuitBreaker` to protect against cascading failures in microservices.

    **Before (No Circuit Breaker):**
    ```java
    public class GroupService {
        public List<Group> loadFromMeetUp() {
            // Direct API call - can fail and cascade
            List<HashMap> techGroups = meetUpApi.techGroups("34", apiKey);
            return toGroupList(techGroups);
        }
    }
    ```

    **After (With Circuit Breaker):**
    ```java
    import org.eclipse.microprofile.faulttolerance.CircuitBreaker;
    import org.eclipse.microprofile.faulttolerance.Fallback;
    import org.eclipse.microprofile.faulttolerance.Retry;

    public class GroupService {
        @CircuitBreaker(requestVolumeThreshold = 4, failureRatio = 0.5, delay = 1000)
        @Retry(maxRetries = 3)
        @Fallback(fallbackMethod = "loadFromMeetUpOnError")
        public List<Group> loadFromMeetUp() {
            List<HashMap> techGroups = meetUpApi.techGroups("34", apiKey);
            return toGroupList(techGroups);
        }

        public List<Group> loadFromMeetUpOnError() {
            return Collections.emptyList(); // Graceful degradation
        }
    }
    ```

    **Key Benefits:**
    - Prevents cascading failures across microservices
    - Automatic retry with configurable attempts
    - Fallback method for graceful degradation
  description: "Detects Java import: org.eclipse.microprofile.faulttolerance.CircuitBreaker"
  category: "optional"
  effort: 2
  labels:
    - "konveyor.io/source=monolith"
    - "konveyor.io/target=microprofile"
  links:
    - title: "Monolith to Microservices Guide"
      url: "https://github.com/lasalazarr/guide-monolithic-to-microservices"
    - title: "MicroProfile Fault Tolerance"
      url: "https://microprofile.io/specifications/microprofile-fault-tolerance/"
  tag: []
  customVariable: []
  when:
    java.referenced:
      pattern: "org.eclipse.microprofile.faulttolerance.CircuitBreaker"
      location: "IMPORT"
