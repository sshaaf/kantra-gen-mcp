---
- ruleID: "add-microprofile-metrics"
  message: |
    Add MicroProfile Metrics to observe and monitor microservice behavior in production.

    **Before (No Metrics):**
    ```java
    public class GroupService {
        public List<Member> loadMembersFromMeetUpGroup(Group group) {
            List<HashMap> membersFromMeetUp = meetUpApi.members(group.getUrlname());
            return toMemberList(membersFromMeetUp);
        }
    }
    ```

    **After (With Metrics):**
    ```java
    import org.eclipse.microprofile.metrics.annotation.Metered;
    import org.eclipse.microprofile.metrics.annotation.Timed;
    import org.eclipse.microprofile.metrics.annotation.Counted;

    public class GroupService {
        @Metered(name = "loadMembers", description = "Rate of member loading")
        @Timed(name = "loadMembersTime", description = "Time to load members")
        public List<Member> loadMembersFromMeetUpGroup(Group group) {
            List<HashMap> membersFromMeetUp = meetUpApi.members(group.getUrlname());
            return toMemberList(membersFromMeetUp);
        }

        @Counted(name = "groupCreations", description = "Number of groups created")
        public Group createGroup(Group group) {
            return groupRepository.add(group);
        }
    }
    ```

    **Available Annotations:**
    - `@Metered` - Tracks invocation rate
    - `@Timed` - Measures execution time
    - `@Counted` - Counts invocations
    - `@Gauge` - Reports a value
  description: "Detects Java import: org.eclipse.microprofile.metrics.annotation.Metered"
  category: "optional"
  effort: 1
  labels:
    - "konveyor.io/source=monolith"
    - "konveyor.io/target=microprofile"
  links:
    - title: "Monolith to Microservices Guide"
      url: "https://github.com/lasalazarr/guide-monolithic-to-microservices"
    - title: "MicroProfile Metrics"
      url: "https://microprofile.io/specifications/microprofile-metrics/"
  tag: []
  customVariable: []
  when:
    java.referenced:
      pattern: "org.eclipse.microprofile.metrics.annotation.Metered"
      location: "IMPORT"
